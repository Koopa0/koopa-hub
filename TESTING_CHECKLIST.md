# 🧪 Koopa Hub - 測試檢查清單

> **版本：** Phase 1 - Artifacts Sidebar & Dashboard Update
> **日期：** 2025-11-18
> **目的：** 確保所有新功能正常運作

---

## ⚙️ 前置作業

### 1. 程式碼生成

**必須執行：**
```bash
flutter pub run build_runner build --delete-conflicting-outputs
```

**預期結果：**
- 生成 `chat_provider.g.dart`
- 包含 `ArtifactSidebarProvider` 的程式碼
- 無錯誤訊息

**檢查項目：**
- [ ] 執行成功，無錯誤
- [ ] 生成的 `.g.dart` 檔案存在
- [ ] 專案可以編譯

---

### 2. 編譯測試

```bash
flutter analyze
```

**預期結果：**
- 無編譯錯誤
- 無型別錯誤
- 僅有輕微的 linter 警告（可接受）

**檢查項目：**
- [ ] `flutter analyze` 執行成功
- [ ] 無紅色錯誤訊息
- [ ] 所有 imports 正確解析

---

## 🎯 功能測試

### A. Artifact 側邊欄測試

#### A1. 觸發 Artifact 生成

**測試步驟：**
1. 啟動應用程式
2. 進入 Conversations 模式
3. 輸入測試指令：`寫一個 Flutter counter 程式`
4. 等待回應完成

**預期結果：**
- [ ] 訊息逐字串流顯示
- [ ] 出現 Artifact 卡片（紫色邊框）
- [ ] 卡片顯示「Generated Code」
- [ ] 卡片有點擊效果（hover 時變色）

**截圖位置：** `screenshots/artifact-card.png`

---

#### A2. 開啟側邊欄

**測試步驟：**
1. 承上步驟
2. 點擊 Artifact 卡片
3. 觀察側邊欄動畫

**預期結果：**
- [ ] 側邊欄從右側展開
- [ ] 聊天區域縮小為 70% 寬度
- [ ] 側邊欄佔 30% 寬度
- [ ] 分隔線清晰可見
- [ ] 側邊欄標題列顯示「Artifact」圖示和標題
- [ ] 右上角有關閉按鈕（X）

**截圖位置：** `screenshots/artifact-sidebar-open.png`

---

#### A3. 側邊欄功能測試

**測試步驟：**
1. 側邊欄開啟狀態
2. 檢查程式碼顯示
3. 測試複製按鈕
4. 在聊天區域輸入新訊息

**預期結果：**
- [ ] 程式碼語法高亮正確（Dart 語法）
- [ ] 程式碼可以選取
- [ ] 複製按鈕功能正常
- [ ] 可以同時在聊天區域輸入訊息
- [ ] 側邊欄保持開啟狀態
- [ ] 新訊息正常顯示

**截圖位置：** `screenshots/artifact-sidebar-interactive.png`

---

#### A4. 關閉側邊欄

**測試步驟：**
1. 側邊欄開啟狀態
2. 點擊右上角關閉按鈕（X）
3. 觀察動畫

**預期結果：**
- [ ] 側邊欄消失
- [ ] 聊天區域擴展為 100% 寬度
- [ ] 佈局平滑轉換（無跳動）
- [ ] Artifact 卡片仍然可見
- [ ] 可以再次點擊卡片重新開啟

**截圖位置：** `screenshots/artifact-sidebar-closed.png`

---

### B. Dashboard 測試

#### B1. 初始狀態（無對話）

**測試步驟：**
1. 清空所有對話（或新安裝）
2. 進入 Home 模式
3. 查看 Recent Conversations 區域

**預期結果：**
- [ ] 顯示「No recent conversations」
- [ ] 顯示空白狀態圖示（history icon）
- [ ] 提示文字：「Start a conversation to see activity here」

**截圖位置：** `screenshots/dashboard-empty.png`

---

#### B2. 有對話狀態

**測試步驟：**
1. 進入 Conversations 模式
2. 發送至少 3 個不同對話
   - 對話 1：「你好」
   - 對話 2：「搜尋最新的Flutter資訊」
   - 對話 3：「寫一個 counter 程式」
3. 返回 Home 模式
4. 查看 Recent Conversations 區域

**預期結果：**
- [ ] 顯示最近 3 個對話卡片
- [ ] 每個卡片顯示：
  - [ ] 對話標題（正確）
  - [ ] 第一則訊息預覽（最多 2 行）
  - [ ] 時間戳記（例如「Just now」、「2 min ago」）
  - [ ] 訊息數量（例如「4 messages」）
  - [ ] 聊天圖示（左側）
  - [ ] 箭頭圖示（右側）
- [ ] 卡片有 hover 效果
- [ ] 卡片按時間排序（最新在上）

**截圖位置：** `screenshots/dashboard-with-conversations.png`

---

#### B3. 點擊對話卡片

**測試步驟：**
1. 承上步驟
2. 點擊第二個對話卡片
3. 觀察頁面變化

**預期結果：**
- [ ] 自動切換到 Conversations 模式
- [ ] 開啟對應的對話
- [ ] 對話內容完整顯示
- [ ] 對話標題正確
- [ ] 模型選擇正確

**截圖位置：** `screenshots/dashboard-click-conversation.png`

---

### C. 觸發關鍵字測試

#### C1. Web Search 觸發

**測試指令：**
```
2025年最新的Flutter版本是什麼？
```

**預期結果：**
- [ ] 顯示思考步驟（3 個步驟）
  - [ ] 理解問題
  - [ ] 規劃搜尋策略
  - [ ] 準備回應
- [ ] 顯示工具調用卡片（Web Search）
- [ ] 工具調用狀態：running → completed
- [ ] 顯示 5 個來源卡片
- [ ] 來源卡片可點擊（開啟外部連結）
- [ ] 文字逐字串流顯示

**其他測試指令：**
- `搜尋 Riverpod 的最新功能`
- `What's the latest news about Dart?`

**截圖位置：** `screenshots/web-search-demo.png`

---

#### C2. Calculator 觸發

**測試指令：**
```
計算 (123 + 456) * 2
```

**預期結果：**
- [ ] 顯示思考步驟（3 個步驟）
  - [ ] 理解問題
  - [ ] 規劃計算步驟
  - [ ] 準備回應
- [ ] 顯示工具調用卡片（Calculator）
- [ ] 工具調用顯示輸入參數
- [ ] 工具調用顯示計算結果
- [ ] 文字逐字串流顯示計算結果

**其他測試指令：**
- `999 - 111 是多少？`
- `Calculate 100 / 5 + 20`

**截圖位置：** `screenshots/calculator-demo.png`

---

#### C3. Code Generation 觸發

**測試指令：**
```
寫一個 Flutter counter 程式
```

**預期結果：**
- [ ] 顯示思考步驟
- [ ] 文字逐字串流顯示說明
- [ ] 顯示 Artifact 卡片
- [ ] 點擊卡片開啟側邊欄
- [ ] 側邊欄顯示 Dart 程式碼
- [ ] 語法高亮正確

**其他測試指令：**
- `Write a function to calculate factorial`
- `請幫我寫一個 Dart class`

**截圖位置：** `screenshots/code-generation-demo.png`

---

#### C4. 一般對話測試

**測試指令：**
```
你好
```

**預期結果：**
- [ ] 無思考步驟
- [ ] 無工具調用
- [ ] 無來源卡片
- [ ] 無 Artifact
- [ ] 僅顯示文字回應
- [ ] 文字逐字串流顯示

**其他測試指令：**
- `什麼是 Flutter？`
- `介紹一下 Material Design 3`

**截圖位置：** `screenshots/general-chat-demo.png`

---

### D. 中文打字效果測試

#### D1. 中文串流測試

**測試步驟：**
1. 輸入任何中文問題
2. 觀察回應文字顯示

**預期結果：**
- [ ] 中文逐字顯示（非整句）
- [ ] 速度適中（50-100ms/chunk）
- [ ] 無閃爍
- [ ] 無中斷

**測試指令：**
- `你好，請介紹一下你自己`
- `什麼是人工智慧？`

---

#### D2. 混合文字測試

**測試步驟：**
1. 輸入中英混合問題
2. 觀察回應文字顯示

**預期結果：**
- [ ] 中英文都能正常逐字顯示
- [ ] 切換自然
- [ ] 無亂碼

**測試指令：**
- `Flutter 是什麼？`
- `解釋 Riverpod provider 的概念`

---

### E. Provider Disposal 錯誤測試

#### E1. 快速切換對話

**測試步驟：**
1. 發送一則訊息
2. 在回應串流期間，立即切換到另一個對話
3. 重複 5 次

**預期結果：**
- [ ] 無錯誤訊息
- [ ] 無 "Cannot use the Ref after it has been disposed" 錯誤
- [ ] 應用程式不崩潰
- [ ] 切換順暢

---

#### E2. 快速返回首頁

**測試步驟：**
1. 發送一則長回應訊息（例如「寫一個 Flutter app」）
2. 在串流期間，立即點擊 Home
3. 重複 3 次

**預期結果：**
- [ ] 無錯誤訊息
- [ ] 串流正常停止
- [ ] 應用程式不崩潰

---

## 📊 效能測試

### F1. 載入時間

**測試步驟：**
1. 冷啟動應用程式
2. 記錄載入時間

**預期結果：**
- [ ] 冷啟動 < 3 秒
- [ ] 熱重載 < 1 秒
- [ ] 切換模式 < 500ms

---

### F2. 記憶體使用

**測試步驟：**
1. 開啟應用程式
2. 發送 10 則訊息
3. 開啟 Artifact 側邊欄
4. 檢查記憶體使用

**預期結果：**
- [ ] 記憶體使用 < 200MB
- [ ] 無記憶體洩漏
- [ ] 應用程式流暢

---

## 🎨 UI/UX 測試

### G1. 響應式佈局

**測試步驟：**
1. 調整視窗大小
2. 測試不同尺寸

**預期結果：**
- [ ] 小視窗：側邊欄仍可正常顯示
- [ ] 大視窗：佈局美觀
- [ ] 無元素重疊
- [ ] 無內容溢出

---

### G2. 深色模式

**測試步驟：**
1. 切換系統深色模式
2. 檢查所有介面

**預期結果：**
- [ ] 所有元素正確套用深色主題
- [ ] 對比度足夠
- [ ] 無白色閃爍
- [ ] 側邊欄顏色正確

---

## ✅ 測試完成標準

所有以下項目必須通過：

- [ ] 所有功能測試通過（A-E）
- [ ] 無編譯錯誤
- [ ] 無執行時錯誤
- [ ] 效能符合標準（F）
- [ ] UI/UX 符合預期（G）
- [ ] 所有截圖已保存

---

## 🐛 已知問題

### 需要在本地執行 build_runner

**問題：**
```
flutter pub run build_runner build --delete-conflicting-outputs
```
必須在本地執行以生成 provider 程式碼。

**狀態：** 📝 待用戶執行

---

## 📝 測試報告範本

完成測試後，請填寫以下報告：

```
測試日期：____________
測試人員：____________
環境：Flutter _____ / Dart _____

功能測試結果：
- Artifact 側邊欄：✅ / ❌
- Dashboard：✅ / ❌
- 觸發關鍵字：✅ / ❌
- 中文打字效果：✅ / ❌
- Provider Disposal：✅ / ❌

效能測試結果：
- 載入時間：✅ / ❌
- 記憶體使用：✅ / ❌

UI/UX 測試結果：
- 響應式佈局：✅ / ❌
- 深色模式：✅ / ❌

整體評分：__ / 10

發現的問題：
1. ___________
2. ___________
3. ___________

建議改進：
1. ___________
2. ___________
3. ___________
```

---

**最後更新：** 2025-11-18
**版本：** v1.0 - Phase 1 Complete
